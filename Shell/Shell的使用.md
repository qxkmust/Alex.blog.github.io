# Shell的使用

### 语法规则：

```
	①以.sh作为后缀

​	②文件内容以#!/bin/bash打头
```

### 用法：

执行sh文件

```
	①在#!/bin/bash后放入一系列的脚本

​	②通过命令 . sh文件 或者 bash sh文件 或者 sh sh文件运行
```

 定义变量

```
	①变量名称由字母、数字和下划线组成
​	②等号两侧不能有空格
​	③默认变量类型都是字符串
​	④变量中如果有空格，需要用双引号包起来
​	⑤环境变量名建议大写
​	⑥定义全局变量，export 变量名
​	⑦变量可以反复赋值，使用unset 变量名销毁变量

常用的系统变量：
	$PWD
	$PATH

特殊变量：
​	$n，n为数字，$1-$9表示第一个到第九个参数，十以上的参数表示${10}，用于脚本传参
​	$#,用于统计脚本传参的个数
​	$*，代表脚本中所有的参数
​	$@，可以代表脚本中所有的参数，不过$@把每个参数区别对待（可用于for in语句进行遍历）
​	$?,返回上一条命令是否正常执行，0为正常，其它为不正常
```

运算符

```
基本语法（三种写法都可以）：
	①$((运算式)) $(1+1)
	②$[运算式] $[1+1]
	③expr + - \* / %,对应加 减 乘 除 取余, expr 1 + 1,注意运算数与运算符之间有一个空格
```

条件判断

```
基本语法：
	①[ condition ]，注意condition前后各有一个空格，condition非空即为true
		多条件判断用&& 或 ||
		用法：[ condition ] && [ condition ] || [ condition ]
	②整数比较，-lt 小于，-gt 大于，-le 小于等于，-ge 大于等于，-eq 等于，-ne 不等于
	③字符串比较，=
	④判断文件权限，-r 读，-w 写，-x操作
		①用法[ -w 文件名 ]
		②再使用$?查看判断结果，0说明拥有权限，其它无权限
	⑤判断文件类型，-e 文件存在，-d 文件存在且是一个目录，-f 文件存在切实一个常规的文件
		①用法：[ -e 文件名 ]
		②使用$? 查看判断结果0，说明存在，其它不存在流程
```

流程控制

```
一：if判断
	基本语法：
	①if [ condition ];then
		代码块
	 fi
	②if [ condition ]
	then
		代码块
	elif [ condition ]
	then
		代码块
	else
		代码块
	fi
	③判断文件存在
		if [ -e "文件路径" ]
	④判断目录存在
		if [ -d "目录" ]
	⑤判断变量非空
		if [ -n "$变量名" ]
	注意：
		①then跟if可以同一行（用分号；隔开），也可以换行
		②没有else分支，只有elif(类似于else if)
		③fi结尾
二：case判断
	基本语法：
	case $变量名 in
	值1){
		如果变量等于给定的值1，执行代码块1
	};;
	值2){
		如果变量等于给定的值2，执行代码块2
	};;
	*)
	esac
	注意：
		①;;相当于break
		②*)相当于default
		③esac结尾
```

循环

```
一：for循环
	基本语法一：
        for((初始变量;循环条件;末尾循环体))
        do	
            循环体
        done
        注意：
            ①for后两对(())
            ②done结束
    基本语法二：
    	for 变量 in 值1 值2 值3
    	do
    		循环体
    	done
二：while循环
	基本语法：
	while [ condition ]
	do
		循环体
	done
```

系统函数

```
dirname，用于获取给定的文件路径中去除文件名（目录）部分的字符串
basename，用于截取最后一个/之后的字符串（文件名）
cut，从文件的每一行剪切字节、字符和字段并将这些字节、字符合字段输出
	基本语法：
		cut[选项] 文件名
		选项:	
			-f,指定切第几列
			-d，分隔符
		用法：
			①从文件log.log中以空格切除第一列
				cut -f 1 -d " " log.log
			②从文件log.log先找出包含error字符串的行，并从其中以空格切除第一列
				cat log.log | grep "error" | cut -f 1 -d " "
sed，功能强大的流编辑器，可以对文件内容进行增删改操作
	基本语法：
		sed[选项] '命令' 文件名
		选项：
			-e，直接在指令列模式上进行sed的操作
			用法：删除文件log.log第二行，并将第三行替换为"hello shell"
				sed -e "2d" -e "3s"
		命令：
			a，新增，a的后面接字符串
				用法：在文件log.log中第二行后面增加一行字符串："hello shell"
                	sed "2a hello shell" log.log
			d，删除
				用法：删除文件log.log第一行
						sed "1d" log.log
					删除包含"hello"的所有行
						sed "/hello/d" log.log
			s，查找并替换指定的字符串（修改）	
				用法：将文件log.log中字符串"shell"全部替换为"world",/g表示全局替换
						sed "s/shell/world/g" log.log
			c，查找并替换指定的行
				用法：将文件log.log中第三行替换为"hello shell"
						sed "3c hello shell"
						
awk，功能强大的文本分析工具，把文件逐行读入，以空格为默认分隔符将每行切片，切开部分再进行分析处理
	基本语法：
		awk[选项] '匹配模式1{命令1} 匹配模式1{命令1} ...' 文件名
		选项：
			-F,指定输入文件分隔符
			-v，赋值一个用户自定义变量
		用法：
		
		需求1：统计有多少行:awk '{print NR}' log.log | tail -n1
				注意NR：每行的记录号
				tail -n1:最后一行的行号
				
		需求2：搜索log.log文件以hello开头的所有行，并输出该行的第一列第二行
				awk '/^hello/&&NR==2{print $1}' log.log
				注意NR：每行的记录号
		需求3：按照","分割行数据,输出该行的前4行前两列
				awk -F ',' 'NR<=4{print $1;print $2}' log.log
				注意：多条命令使用;分割
		需求4：计算bill文件第三列的金额总和并打印
				awk -F '\t' '{sum += $3} END {print sum}' /opt/hive-1.2.1/mydb/bill
				注意：END:分割代码块
sort,排序
	基本语法：
		sort(选项)(参数)
		选项：
			-n，按照数字大小自然排序
			-r，倒序排序
			-t，排序前的分割符
			-k，指定需要排序的列
		用法：对log.log文件中以下数据中冒号分割的第二列进行从大到小排序
                    lili:100:best
                    zhangsan:60:pass
                    wangwu:80:good
             sort -t : -nrk 2 log.log
```

read读取控制台输入

```
基本语法：
	read(选项)(参数)
	选项：
		-p，指定读取值时的提示符
		-t，指定读取等待的时间（秒）
	参数：
		变量，用于获取输入的值
	用法：
		①在10秒内，读取控制台输入的值赋给str
			①read -p "10秒内有效输入" -t 10 str
			②echo $str，打印出来
```

自定义函数

```
基本语法：
	定义：
	[ function ] 函数名[()]
	{
		函数体
	}
	调用：函数名 参数1 参数2 ...
	注意：函数体内可以通过$n获取各个参数
```

### ssh（secure shell）

```
ssh可以实现远程访问别的主机，根据验证方式不同分为两种：
第一种：基于口令的验证
默认这种
【原理】：
    ①客户端发起ssh请求之后，服务器把自己的公钥传给客户端
    ②客户端输入服务器密码通过公钥加密之后传给服务器
    ③服务器根据自己的私钥解密登录密码，如果正确那么就让客户端登录
第二种：基于密钥（公钥和私钥）
需要额外配置
【原理】：
    ①首先在客户端使用命令ssh-keygen生成一对密钥；
    ②并将客户端的公钥ssh-copy-id 拷贝到服务端；
    ③当客户端再次发送一个连接请求，包括ip、用户名；
    ④服务端得到客户端的请求后，会到authorized_keys中查找，如果有相应的IP和用户，就会随机生成一个字符串，例如：qwer；
     ⑤服务端将使用客户端拷贝过来的公钥进行加密，然后发送给客户端；
    ⑥得到服务端发来的消息后，客户端会使用私钥进行解密，然后将解密后的字符串发送给服务端；
    ⑦服务端接受到客户端发来的字符串后，跟之前的字符串进行对比，如果一致，就允许免密码登录。
    
    注意：ssh-keygen命令生成以下文件
			#################################################
            known_hosts		记录ssh访问过的计算机的公钥
            id_rsa			生成的私钥
            id_rsa.pub		生成的公钥
            authorized keys 存放授权过的无密登录的服务器公钥
			#################################################

免密登录：
生产中常需要配置免密登录，如集群服务器的进程（hadoop集群，zookeeper集群等）通过ssh进行远程通信
对于三台虚拟机hadoop02、hadoop03、hadoop04，演示：

第一种情况：针对root用户配置免密登录：
    ①生成公钥和私钥，使用命令：
    	ssh-keygen -t rsa
    	注意：-t 指定秘钥类型为rsa
    ②敲三次回车，会在/root/.ssh目录下生成公钥id_rsa.pub和私钥id_rsa
    ③进入/root/.ssh/目录，将公钥拷贝到要免密登录的目标服务器
    	ssh-copy-id -i id_rsa.pub 主机名/ip
    ④在节点hadoop02、hadoop03、hadoop04上分别操作以上三步，保证三个节点两两之间都可以免密登录

第二种情况：针对普通用户配置免密登录：
    区别在于：普通用户会在~/.ssh目录下生成公钥id_rsa.pub和私钥id_rsa
```

### ssh -t

```
针对有些命令必须要在指定目录下才能执行，比如启动可视化客户端yanagishima，就必须在yanagishima的安装目录下才能执行./bin/yanagishima-start.sh
如何解决：
ssh -t hadoop02 "cd /opt/yanagishima-18.0;source etc/profile;./bin/yanagishima-start.sh;bash"
【命令】ssh -t【开启伪终端，迫使ssh客户端以交互模式工作】 "多个shell命令;bash【指定shell执行器是bash】"
```

